syntax = "proto3";

package api.copy.v1;

option go_package = "block/api/copy/v1;v1";
option java_multiple_files = true;
option java_package = "api.copy.v1";

service CopyTradeService {
    rpc CreateCopyOrder (CreateCopyOrderRequest) returns (CreateCopyOrderReply);
    rpc GetCopyOrder (GetCopyOrderRequest) returns (GetCopyOrderReply);
    rpc GetCopyOrderList (GetCopyOrderListRequest) returns (GetCopyOrderListReply);
    rpc CancelCopyOrder (CancelCopyOrderRequest) returns (CancelCopyOrderReply);
}

// 交易类型
enum TradeType {
    TRADE_TYPE_UNSPECIFIED = 0;
    TRADE_TYPE_BUY = 1;  // 买入
    TRADE_TYPE_SELL = 2; // 卖出
}

// 买入策略
message BuyStrategy {
    string min_amount = 1; // 最小买入金额(带精度)
    string max_amount = 2; // 最大买入金额(带精度)
    uint32 strategy = 3; // 策略类型: 0是固定 1是百分比
    string strategy_value = 4; // 策略值：固定金额或百分比
    double slippage_tolerance = 5; // 滑点容忍度
}

// 卖出策略
message SellStrategy {
    double percentage = 1; // 卖出百分比
    double slippage_tolerance = 2; // 滑点容忍度
}

// 跟单条件
message CopyConditions {
    optional string min_pool_size = 1; // 最小池子大小(k)
    optional string max_pool_size = 2; // 最大池子大小(k)
    optional string min_buy_amount = 3; // 目标地址最小买入金额(带精度)
    optional string max_buy_amount = 4; // 目标地址最大买入金额(带精度)
    optional string min_market_cap = 5; // 最小市值(k)
    optional string max_market_cap = 6; // 最大市值(k)
}

message CreateCopyOrderRequest {
    string chain = 1; // 链
    string user_address = 2; // 用户地址
    string target_address = 3; // 目标地址
    string private_key = 4; // 用户私钥
    string biz_order_id = 5; // 业务订单id
    string biz_user_id = 6; // 业务用户id
    
    // 交易类型
    TradeType trade_type = 7;
    
    // 买入策略 (当trade_type包含买入时必填)
    optional BuyStrategy buy_strategy = 8;
    
    // 卖出策略 (当trade_type包含卖出时必填)
    optional SellStrategy sell_strategy = 9;
    
    // 跟单条件
    optional CopyConditions copy_conditions = 10;
    
    // 过期时间 (Unix时间戳)
    int64 expire_time = 11;
}

message CreateCopyOrderReply {
    string order_id = 1;
}

message GetCopyOrderRequest {
    string order_id = 1;
}

message GetCopyOrderReply {
    string order_id = 1; // 订单ID
    string chain = 2; // 链
    string user_address = 3; // 用户地址
    string target_address = 4; // 目标地址
    string biz_order_id = 5; // 业务订单id
    TradeType trade_type = 6; // 交易类型
    optional BuyStrategy buy_strategy = 7; // 买入策略
    optional SellStrategy sell_strategy = 8; // 卖出策略
    optional CopyConditions copy_conditions = 9; // 跟单条件
    int64 expire_time = 10; // 过期时间
    uint64 status = 11; // 状态
    string message = 12; // 消息
    string created_at = 13; // 创建时间
    string updated_at = 14; // 更新时间
}

message GetCopyOrderListRequest {
    string user_address = 1; // 用户地址
    string target_address = 2; // 目标地址
    string biz_user_id = 3; // 业务用户id
    string chain = 4; // 链
    string biz_order_id = 5; // 业务订单id
}

message GetCopyOrderListReply {
    repeated GetCopyOrderReply orders = 1; // 订单列表
}

message CancelCopyOrderRequest {
    string order_id = 1;
}

message CancelCopyOrderReply {
    string order_id = 1;
}