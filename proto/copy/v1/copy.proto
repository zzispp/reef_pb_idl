syntax = "proto3";

package api.copy.v1;

option go_package = "block/api/copy/v1;v1";
option java_multiple_files = true;
option java_package = "api.copy.v1";

service CopyTradeService {
    rpc CreateCopyOrder (CreateCopyOrderRequest) returns (CreateCopyOrderReply);
    rpc GetCopyOrder (GetCopyOrderRequest) returns (GetCopyOrderReply);
    rpc GetCopyOrderList (GetCopyOrderListRequest) returns (GetCopyOrderListReply);
    rpc CancelCopyOrder (CancelCopyOrderRequest) returns (CancelCopyOrderReply);
}


// 日志条目
message LogEntry {
    int64 timestamp = 1;  // 时间戳
    string message = 2;   // 日志信息
}

// 买入策略
message BuyStrategy {
    string min_amount = 1; // 最小买入金额(带精度)
    string max_amount = 2; // 最大买入金额(带精度)
    uint32 strategy = 3; // 策略类型: 0是固定 1是百分比
    string strategy_value = 4; // 策略值：固定金额或百分比
    double slippage_tolerance = 5; // 滑点容忍度
}



// 跟单条件
message CopyConditions {
    optional string min_pool_size = 1; // 最小池子大小(k)
    optional string max_pool_size = 2; // 最大池子大小(k)
    optional string min_buy_amount = 3; // 目标地址最小买入金额(带精度)
    optional string max_buy_amount = 4; // 目标地址最大买入金额(带精度)
    optional string min_market_cap = 5; // 最小市值(k)
    optional string max_market_cap = 6; // 最大市值(k)
}

message CreateCopyOrderRequest {
    string chain = 1; // 链
    string user_address = 2; // 用户地址
    string target_address = 3; // 目标地址
    string private_key = 4; // 用户私钥
    string biz_order_id = 5; // 业务订单id
    string biz_user_id = 6; // 业务用户id
    
    // 买入策略
    optional BuyStrategy buy_strategy = 7;
    
    // 跟单条件
    optional CopyConditions copy_conditions = 8;
    
    // 是否跟卖
    bool follow_sell = 9;
    
    // 过期时间 (Unix时间戳)
    int64 expire_time = 10;
}

message CreateCopyOrderReply {
    string order_id = 1;
}

message GetCopyOrderRequest {
    string order_id = 1;
}

message GetCopyOrderReply {
    string order_id = 1; // 订单ID
    string chain = 2; // 链
    string user_address = 3; // 用户地址
    string target_address = 4; // 目标地址
    string biz_user_id = 5; // 业务用户id
    optional BuyStrategy buy_strategy = 6; // 买入策略
    optional CopyConditions copy_conditions = 7; // 跟单条件
    bool follow_sell = 8; // 是否跟卖
    int64 expire_time = 9; // 过期时间
    uint64 status = 10; // 状态
    string message = 11; // 消息
    string created_at = 12; // 创建时间
    string updated_at = 13; // 更新时间
    repeated LogEntry logs = 14; // 执行日志
}

message GetCopyOrderListRequest {
    string user_address = 1; // 用户地址
    string target_address = 2; // 目标地址
    string biz_user_id = 3; // 业务用户id
    string chain = 4; // 链
    string biz_order_id = 5; // 业务订单id
    int32 page = 6; // 页码，从1开始，默认为1
    int32 page_size = 7; // 页大小，默认为20，最大100
}

message GetCopyOrderListReply {
    repeated GetCopyOrderReply orders = 1; // 订单列表
    // 分页信息
    int64 total = 6; // 总记录数
    int32 page = 7; // 当前页码
    int32 page_size = 8; // 当前页大小
}

message CancelCopyOrderRequest {
    string order_id = 1;
}

message CancelCopyOrderReply {
    string order_id = 1;
}